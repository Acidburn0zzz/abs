pkgname=usbutils
pkgver=008
pkgrel=3
epoch=1
pkgdesc="USB Device Utilities"
arch=(i686 amd64)
license=('GPL')
depends=()
optdepends=('python2: for lsusb.py usage'
            'coreutils: for lsusb.py usage')
url="http://linux-usb.sourceforge.net/"
source=("http://www.kernel.org/pub/linux/utils/usb/usbutils/${pkgname}-${pkgver}.tar.xz"
        fix-python2.patch
	revert-udev-commit.patch
	revert-hwdb.patch)

prepare()
{
  cd $srcdir/$pkgname-$pkgver
  touch usb.ids
  touch update-usbids.sh.in
  patch -p1 -R -i ../revert-udev-commit.patch
  patch -p1 -R -i ../revert-hwdb.patch
  autoreconf -vfi
}
build() {
  cd $srcdir/$pkgname-$pkgver
  # patch lsusb.py to use correct usb.ids file and python2 interpreter
  patch -Np1 -i $srcdir/fix-python2.patch
  ./configure --prefix=/usr --datadir=/usr/share/hwdata --disable-zlib
  gmake
}

package() {
  cd $srcdir/$pkgname-$pkgver
  gmake DESTDIR=$pkgdir install
  # this is now in the hwids package
  rm -rf $pkgdir/usr/{share/hwdata,sbin}
}
md5sums=('2780b6ae21264c888f8f30fb2aab1259'
         '45766196895b4cc50b53cd56e1bbf3d1'
         'b526dc5d7974b00d460c40968f19fac0'
         '895a2e39bbab912b76f9f6235631f6f7')
