# $Id: PKGBUILD 156348 2012-04-17 15:57:54Z andyrtr $
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Contributor: Wolfgang Bumiller <blub@speed.at>

pkgname=libgcrypt
pkgver=1.6.2
pkgrel=1
pkgdesc="a general purpose crypto library based on the code used"
arch=(i686 x86_64)
url="http://www.gnupg.org"
license=('LGPL')
depends=('libgpg-error>=1.10-2')
options=('!emptydirs' 'libtoolfix')
makedepends=('libtool>=2.4.2-11' 'libgpg-error')
depends=('gettext' 'libgpg-error')
_port_patches=(
	patch-gcrypt.h.in
)
source=(ftp://ftp.gnupg.org/gcrypt/${pkgname}/${pkgname}-${pkgver}.tar.bz2
	${_port_patches[@]}
)
sha1sums=('cc31aca87e4a3769cb86884a3f5982b2cc8eb7ec'
          '0b016096028a78d3649f6b3644c61ba6fd12706d')

prepare() {
  cd ${pkgname}-${pkgver}
  for i in ${_port_patches[@]}; do
    msg "patch $i"
    patch -p0 -i "${srcdir}/$i"
  done
# remove info files
  rm -f doc/gcrypt.info*

  sed -i '' -e 's|ALIGN (3)|ALIGN (2)|g' mpi/i386/*.S

  gsed -i -e '/^SUBDIRS =/s/ doc//g' Makefile.in

}

build() {
  cd "${srcdir}/${pkgname}-${pkgver}"

  ./configure --prefix=/usr \
    --disable-padlock-support \
    --enable-shared
  make
}

package() {
  cd ${srcdir}/${pkgname}-${pkgver}
  make DESTDIR=${pkgdir} install

  install -dm755 "${pkgdir}/usr/share/licenses/${pkgname}-${pkgver}"
  install -m644 COPYING "${pkgdir}/usr/share/licenses/${pkgname}-${pkgver}/LICENSE"
}

