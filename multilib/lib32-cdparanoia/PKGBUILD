# $Id: PKGBUILD 89185 2013-04-27 17:40:20Z alucryd $
# Maintainer: Maxime Gauduin <alucryd@gmail.com>

pkgname=lib32-cdparanoia
pkgver=3.9.8
pkgrel=1
pkgdesc="Compact Disc Digital Audio extraction tool"
arch=('x86_64')
url="http://www.xiph.org/paranoia/"
license=('GPL')
depends=("${pkgname#*-}" 'lib32-libc')
makedepends=('gcc-multilib')
options=('!makeflags')
source=("http://www.xiph.org/paranoia/download/cdparanoia-III-alpha9.8.src.tgz"
        'gcc.patch'
        patch-Makefile.in
        patch-configure
        patch-interface-Makefile.in
        patch-interface-cdda_interface.h
        patch-interface-common_interface.c
        patch-interface-cooked_interface.c
        patch-interface-interface.c
        patch-interface-low_interface.h
        patch-interface-scan_devices.c
        patch-interface-scsi_interface.c
        patch-interface-utils.h
        patch-paranoia-Makefile.in
        patch-paranoia-cdda_paranoia.h
        patch-utils.h
        patch-version.h)
sha256sums=('005db45ef4ee017f5c32ec124f913a0546e77014266c6a1c50df902a55fe64df'
            '9a3f3802856e96080fb30562a10899ef3378723e85f289fa29619b21d6051575')

prepare() {
	cd "${srcdir}/cdparanoia-III-alpha9.8"
  for i in patch-Makefile.in patch-configure \
  	       patch-interface-Makefile.in patch-interface-cdda_interface.h \
  	       patch-interface-common_interface.c \
  	       patch-interface-cooked_interface.c patch-interface-interface.c \
  	       patch-interface-low_interface.h patch-interface-scan_devices.c \
  	       patch-interface-scsi_interface.c patch-interface-utils.h \
  	       patch-paranoia-Makefile.in patch-paranoia-cdda_paranoia.h \
  	       patch-utils.h patch-version.h
  do
    patch -p0 -i "${srcdir}/$i"
  done

}

build() {
	cd "${srcdir}/cdparanoia-III-alpha9.8"
  export CC="gcc -m32"
  export CXX="g++ -m32"
  export PKG_CONFIG_PATH="/usr/lib32/pkgconfig"

	sed -i '' -e 's/\(^ *default:\)/\1break;/' interface/utils.h
  ./configure --prefix=${pkgdir}/usr --libdir='${prefix}/lib32'
  gmake
}

package() {
	cd "${srcdir}/cdparanoia-III-alpha9.8"
  gmake DESTDIR="${pkgdir}" install
  rm -rf "${pkgdir}"/usr/{bin,include,share}
}

# vim: ts=2 sw=2 et:
