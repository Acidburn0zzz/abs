# $Id: PKGBUILD 75640 2012-08-27 22:14:26Z arodseth $
# Maintainer: Alexander RÃ¸dseth <rodseth@gmail.com>
# Contributor: Mateusz Herych <heniekk@gmail.com>
# Contributor: Christoph Siegenthaler <csi@gmx.ch>

pkgname=espeak
pkgver=1.48.04
pkgrel=1
pkgdesc="Text to Speech engine for good quality English, with support for other languages"
arch=('x86_64' 'i686')
url='http://espeak.sourceforge.net/'
license=('GPL')
depends=('portaudio' 'libpulse')
options=('!emptydirs')
port_patches=(
	patch-src__Makefile
)
source=("http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver-source.zip"
	"${port_patches[@]}")
sha256sums=('bf9a17673adffcc28ff7ea18764f06136547e97bbd9edf2ec612f09b207f0659'
            '7c2c764ec51e9e9b6e06090e40f11ebc20036cde11a76d94688f70dc4a6dcbec')

build() {
  cd "$srcdir/${pkgname}-${pkgver}-source/src"

  for _patch in ${port_patches[@]}; do
    msg "Patching port patch $_patch"
    patch -p0 -i "${srcdir}/$_patch"
  done

  cp portaudio19.h portaudio.h
  gmake CXXFLAGS="$CXXFLAGS" AUDIO=runtime
}

package() {
  cd "$srcdir/$pkgname-$pkgver-source/src"

	# We get operation not support with the ACL when using zfs and -p with cp
  sed -i '' -e 's|pRf|Rf|g' Makefile

  gmake DESTDIR=$pkgdir install
  chmod 644 "$pkgdir/usr/lib/libespeak.a"
}

# vim:set ts=2 sw=2 et:
